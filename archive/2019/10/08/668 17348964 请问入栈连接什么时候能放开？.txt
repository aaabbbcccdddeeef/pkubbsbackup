#t 668 17348964 Kurapica 2019-10-08 00:20:00 xiaowei 2019-10-28 21:44:00
请问入栈连接什么时候能放开？

#p 21064711 Kurapica 库卡 2019-10-08 20:37:27


2019-10-08 20:37:01
3389、22什么的
在校外简直没法干活了
而且现在都不按端口封了？直接检查协议么？我改了端口号还是连不进来，必须连VPN，连了VPN我其他VPN就乱了，这太糟糕了
@PKUCC

#p 21064781 PKUCC 北京大学计算中心 2019-10-08 20:50:21
您好，为贯彻落实上级部门要求，学校将进一步强化网络安全保障工作。根据上级部门相关文件精神、《北京大学网络安全管理办法》及配套制度的有关规定，我校各级各类网站均须在北京大学网站备案系统登记备案，方可对外提供服务。
如您在校外（家中、出差或国外）需要访问限制在校园网内部的服务，建议使用北京大学VPN服务（具体参见[https://its.pku.edu.cn/service_1_vpn_client.jsp](jump-to.php?url=https%3A%2F%2Fits.pku.edu.cn%2Fservice_1_vpn_client.jsp) ）。 
感谢您的配合！
#quote Kurapica

#p 21064946 BobDylan Robert Allen Zimmerman 2019-10-08 21:14:28
SSH都不行，太imba了吧
#quote PKUCC

#p 21064956 Kurapica 库卡 2019-10-08 21:19:36


2019-10-08 21:17:11
您好。我能理解80、8080、443、21等端口算“对外提供服务”。可是远程桌面连接和SSH也算“对外提供服务”么？我的SSH端口并未挂接BBS等服务，仅用于远程运行代码，这也算对外提供服务？
另外，可能是我搜索能力有限，但我并未找到《北京大学网络安全管理办法》的全文。在北大首页和its上都未找到，请勿援引一个未经公布的管理办法，或请公开此管理办法。
再次，在相关文件中，我找到如下可能和互联网服务相关的文件：
[1] 《互联网安全保护技术措施规定》-- 公安部
[2] 《非经营性互联网信息服务备案管理办法》-- 信息产业部
[3] 《全国人民代表大会常务委员会关于维护互联网安全的决定》-- 全国人大常委会
[4] 《计算机信息网络国际联网安全保护管理办法》-- 公安部
在文件[1]、[3]中，本人并未找到与“备案”相关的条款。
在文件[4]中，本人只找到了与备案手续相关的管理办法，并未发现与信息服务有关的条
款。
在文件[2]中，有一条对提供非经营性互联网信息的解释：
    本办法所称在中华人民共和国境内提供非经营性互联网信息服务，是指在中华人民共和国境内的组织或个人利用通过互联网域名访问的网站或者利用仅能通过互联网IP地址访问的网站，提供非经营性互联网信息服务。
本人认为，远程桌面连接与SSH服务不能称为“网站”。狭义的网站指HTTP/HTTPS服务，广义的网站可以认为是信息提供者，包括BBS等。但1对1的远程桌面连接、SSH登录等并不对群众提供任何信息，计算中心这种封锁服务完全是懒政。
进一步地，在文件[1]中，计算中心可能已经涉及违反了第十四条第四款：擅自改变安全保护技术措施的用途和范围。
希望计算中心能够以用户为中心出发，停止简单粗暴的“一刀切”工作。拔网线这个工作并不需要专业技能，前校长许智宏就曾成功拔过网线以至落得一身骂名。希望计算中心在保证北大网络安全的前提下，能够保证北大校园网正常的开放性，而不是远比政府要求的紧。
最后问一句，PING什么时候能放开？呵呵。
参考文献：
[1] [https://its.pku.edu.cn/rule_1_security.jsp](jump-to.php?url=https%3A%2F%2Fits.pku.edu.cn%2Frule_1_security.jsp)
[2] [https://its.pku.edu.cn/rule_1_non_operational.jsp](jump-to.php?url=https%3A%2F%2Fits.pku.edu.cn%2Frule_1_non_operational.jsp)
[3] [https://its.pku.edu.cn/rule_1_internet_security.jsp](jump-to.php?url=https%3A%2F%2Fits.pku.edu.cn%2Frule_1_internet_security.jsp)
[4] [http://www.gov.cn/gongbao/content/2011/content_1860856.htm](jump-to.php?url=http%3A%2F%2Fwww.gov.cn%2Fgongbao%2Fcontent%2F2011%2Fcontent_1860856.htm)
#quote PKUCC

#p 21065176 xiaowei 小薇 2019-10-08 21:53:31
而且贵校的vpn连接速度也太慢了，还总断线，根本无法愉快的跑代码。
每次问计算中心，都反过来叫我报备网站。你们管这个ssh的远程连接叫网站？？？
#quote PKUCC

#p 21065340 Speedster 胖胖的猪 2019-10-08 22:23:59
强 re！在校外不能用 ssh, jupyter lab 真是寸步难行！
#quote Kurapica

#p 21065591 ljslcy StupidArcher 2019-10-08 23:20:28
顶
在家出游无法顺畅工作，没想到连接自己宿舍台式机和服务器都得翻墙，体验极差
是不是计算中心看大家科研压力太大了给大家一个理由放假(滑稽保命)
#quote Kurapica

#p 21068798 Kurapica 库卡 2019-10-09 15:25:38
计算中心对"网站"的理解有严重的错误。
#quote xiaowei

#p 21069205 sxpeter  2019-10-09 16:42:00
国外用先不说了
先说国内，在内蒙古自治区用联通3G/4G访问VPN就慢的不行。。敲一个字符都要顿上好几秒
#quote PKUCC

#p 21074061 RyanBern r.bern 2019-10-10 17:05:19


2019-10-10 13:38:59
这个问题貌似已经讨论过很多次了。确实有很多人对这个有意见。例如下面这个帖子：
[https://bbs.pku.edu.cn/v2/post-read.php?bid=668&amp;threadid=17233892](post-read.php?bid=668&amp;threadid=17233892)
关于什么端口可以用的问题，一直没有个明文规定。大约两年前计算中心突然发布了各个网站管理员需要备案服务器的通知，要求对外开设信息服务的机器进行备案。当时给的例子是 http, https, ftp 等。我曾给计算中心打电话询问服务器只开设 ssh 服务是否要备案，当时计算中心老师的说法是**不用**。
我翻查了计算中心的规定，发现只有下面这两条和开设服务最接近。
﻿详见《北京大学校园网用户守则》[https://cc.pku.edu.cn/rule_campus_network.jsp](jump-to.php?url=https%3A%2F%2Fcc.pku.edu.cn%2Frule_campus_network.jsp)
第十条表明，单位用户提供信息服务必须先备案，个人用户不得开设对外信息服务。第十一条表明，任何人不得架设代理，开设 DHCP 服务等。其中出问题的地方是：什么叫做**信息服务**？如果有不按照规定开设服务器的用户该如何处理？
第一个问题，计算中心没有给出一个详细的说明，例如 ssh 到底算不算信息服务。按照两年前的定义来讲，ssh 是不算的。但现在的说法，只要是一个允许外网访问的服务（端口）就算是信息服务。
第二个问题，目前计算中心的处理做法我猜应该是无差别端口封禁。即入栈连接只放行备案过的 IP 的端口，其余一律阻止。而校内之间互相连接不会受到此影响。
网络安全这块监管非常困难，魔高一尺道高一丈。计算中心出了规定，就总有不老实的用户和该规定作对。比方说，之前 22 端口还可以连接的时候，把 http(s) 服务强行开到 22 端口上是否可以？再比方说，计算中心严禁架设代理，但用 ssh 有一个动态端口转发的功能，可以当成一个 socks5 代理用，那么请问你开设的到底是 ssh 服务还是代理服务？这些都很难进行监管。我觉得计算中心目前没有这样的技术能力做出这样的识别，否则早就被做 GFW 那帮人挖走了。综上，计算中心直接采用了一刀切的做法，直接不允许校外对校内未备案的服务器发起连接。这应该是目前最合适的方法了。要挑毛病的话就是程序上不太正义，至少应该更新一下网络安全规定的说明。
PS：封禁 22 端口的事情应该是今年 8 月份左右发生的。当时计算中心给的理由是“发现大量猜密码攻击”。从个人方面来讲我是支持计算中心这个出发点的。如果做过服务器管理员的话你就会发现每天都有那么几个校内地址对你的服务器发起成千上万的连接。这些主机基本上都是被黑客攻击的肉鸡，黑客在上面部署了暴破/挖矿的程序，对校园网安全是个很大的威胁。据我所知有相当一部分服务器管理员缺乏网络安全常识，在自己工位上搭 ssh 服务的人可能更是如此，为了自己方便跑了一个 ssh 了事，根本不管安全性。增加备案的好处就是出了事可以明确追究责任，否则计算中心只能无休止地封禁 IP。
#quote Kurapica

#p 21075117 Kurapica 库卡 2019-10-10 17:32:47


2019-10-10 17:32:20
关于flood和防止提供服务，完全可以通过两个rule来解决
1: 连接频率
2: 连接数量
这些rule在任何稍微高级的fw里都是非常基本的功能。距离GFW用到的技术大概有10个马里亚纳海沟的距离。不明白你为什么还支持一刀切？
#quote RyanBern

#p 21075255 RyanBern r.bern 2019-10-10 18:56:28


2019-10-10 18:10:41
我下面的回复可能有点跑题，但基本意思是“目前暂时没有行之有效的手段来保证开服务的安全规范，因此索性大家都别用了”。
GFW 的例子仅仅是说明很难区分你是用 ssh 在进行跑程序的常规操作还是在架设代理，跟连接频率，数量没关系。就算你连接数量是 1，但你实际是在搭建代理，按照第十一条规定是违规的。个人计算中心目前的技术是无法区分你到底用 ssh 干了什么事情。PS：用 ssh socks5 代理进行科学上网在之前非常火热，之后 GFW 通过流量特征识别可以分辨出来这个区别，所以这个方式早就凉了。
如果我没理解错的话，设置连接频率/数量应该针对的是外面向（非备案）端口发起连接？然后发现异常就不让建立连接？这个其实原则上应该交给各个服务器负责的人吧，计算中心我看目前是没有配置这个的打算。而且总觉得没这么简单，还是那句话，不太清楚计算中心的具体技术实现水平，目前来看最可能的方案就是全端口无差别封禁+出台正式规定。
---
我觉得出现这样的争端的根本原因是学校的 VPN 体验太差，挂 VPN 连回校内远不如直接访问服务。但一旦你有办法连回校内，你就有办法开设各种形式的代理。
#quote Kurapica

#p 21075424 Kurapica 库卡 2019-10-10 19:18:14
#quote RyanBern
我并不认为你成功地证明了这个结论。证明一个东西没有手段比证明有手段难多了。我不想和你抬杠，这事儿的确是不好证明，你也的确没证明。
我自己给自己搭个sock5回来有问题么？连接数是1，是我自己自用的，这算是对“外”提供服务？而且，GFW sock5并没有凉，起码我的3个自用的server从未被卡过。
你刚说服务器负责人并没有能力，的确很多人桌面跑个ubuntu设置个123456的密码就回家远程了，这种用户很多，我认同你的观点，这种人会给校园网造成很大的损害，外面小流量利用校内肉鸡可以通过校园网的高网速放大攻击速度。但是，连接数量限制根本不用太高级的fw，BSD自带的IPFW用limit命令就能做到，连接频率就更容易了。详情请查看ipfw(8)。所以，我认为的“比较容易”和你认为的“比较难”，应该和小马过河是一个道理。在我看来计算中心完全应该有能力用更好的方式解决这个问题。如果像现在这么解决，那么，一个可能是他们比较笨(这个不应该，他们很专业的)，第二个可能是他们比较懒，第三个可能是他们不想搞出风险，无法对贵校现任的两个党委书记交待。
如果我要连学校的VPN，默认所有流量都会从VPN走，我还得写一个很长的脚本，把所有不指向北大的连接redirect到我的默认网关。虽然这不是额外的工作量，但不是所有人都会操作自己本机的路由表的，例如 @peiyangium 院士好像就和这个事儿斗争了很久。如果我有另一个VPN要连，那么问题就更加复杂了。再举个例子，比如我要用学校的IP访问某些期刊网站，我还得临时再把这些期刊网站的IP从我的脚本里面抠出来，这就增加了很多额外的工作量。所以，你看起来对你不是很麻烦的一个事儿，对于一万个人可能有一万种麻烦。这就是我批评计算中心懒政的原因：不是我搞不定，而是我觉着这事儿根本不应该扔给用户去搞，你们坐在那儿拿着工资，不是写几条rule封封端口就够的吧？

#p 21075665 RyanBern r.bern 2019-10-10 20:46:52


2019-10-10 20:44:02
我同意你的点：
1. 不管什么原因，计算中心有些做法影响一些用户的体验。原因就像你说的 1) 没能力 2) 懒 3) 怕出事，应该三者皆有吧。之前我可能太强调“能力”有一点片面。
2. 学校 VPN 确实难用。
我不同意你的点：
1. 我说的“难”指的是解决校园网使用规范很难，而**并非配置规则本身**。就这个问题而言，我并不认为配置了连接频率/数量限制就能使得校园网使用变得规范。这个是否规范是学校出的政策决定的，不是我们个人说它规范就规范了。
﻿2. 在学校内部配置个代理连回来，就算只有你自己用，依然有问题。因为它违反了用户守则第十一条，跟对不对外没关系。况且谁也不能保证自己搭的服务器 100% 安全，这个责任不如交给计算中心承担。
3. 关于 ssh + socks5 是否凉的问题不作讨论，和本贴主题无关。在这里我假设我们讨论的是同一个东西（ssh -D localhost:1080）。
#quote Kurapica

#p 21075953 Kurapica 库卡 2019-10-10 21:55:28
问题1：Windows RDP属于第11条么？
问题2：因为SSH能允许tunnel就封禁，和因为jb能用来强奸就禁止携带jb到某些场所有什么本质区别？
#quote RyanBern

#p 21076283 RyanBern r.bern 2019-10-10 22:27:28
问题1：不属于。
问题2：ssh 不是代理。这种比喻没有任何意义。我也没有说禁止 ssh 是因为 ssh 能开 tunnel（计算中心之前禁止 ssh 的原因已经说了，是因为有猜密码攻击）。只是借助 ssh 的特性来说明想要限制用户可以用校园网做那些事不能做哪些事是非常困难的。如果楼主不能接受这样的例子，你可以把里面 ssh 都换成开在 22 端口的 squid 服务器或者 shadowsocks 服务器，我表达的意思不变。
---
楼主的点在于：我的用法都是合理的良民用法，为什么计算中心非要给我堵死这条路给我添麻烦？
我的点在于：鉴于大多数用户是小白，而且想要精准不影响楼主这样用户并且维护校园网使用规范很难。因此禁止外网访问未备案端口的做法在目前条件下是合理的。
从用户角度上来说，我和楼主一样，我也有很多电脑上开了 ssh 服务，有时候会甚至开 http 服务来远程给校外人发文件（发完就关那种）。学校把端口堵死之后我也很无奈，从前能享受到的方便没有了。但之前开服务确实是个灰色地带，没有人说它合理或者不合理，能用就用一下，用不了也没必要埋怨什么。个人觉得计算中心唯一的锅在于没有说清楚需要报备是哪份文件说明的，以及在用户规定中对“信息服务”的定义不清。
最后衷心希望计算中心能够搞出好用的入校代理，给我们这些放假回家还要科研的人一些生存的空间。
#quote Kurapica

#p 21076900 sxpeter  2019-10-11 01:22:36
#quote RyanBern
能这么折腾的怕是没几个小白了吧。。

#p 21078775 Jackieyang valkjsaaa 2019-10-11 13:56:55
求开放高位端口的入栈链接
#quote Kurapica

#p 21078836 juruo 蒟蒻MagicPoi 2019-10-11 14:08:20
大佬！
#quote sxpeter

#p 21210673 xinxinxinxin 欣 2019-10-27 11:11:01
就是全部封掉了，啥端口都不好使。
这就是一个学校对科研的态度，不是让科研更方便。不是有需求来解决，而是各种理由反正就是别给领导的升官发财添麻烦。
#quote Kurapica

#p 21211488 xinxinxinxin 欣 2019-10-27 14:22:47
那就只有拔网线了呗？网络安全是为了使用而保障的，阉割掉正常的使用谈什么安全
#quote RyanBern

#p 21213761 xinxinxinxin 欣 2019-10-27 23:22:14
谁搞个像样点的帖子，大家一起搞一搞，搞个十大看看有没有解决的希望吧。
谈什么规定和道理，有用吗？
给乌纱帽们制造的麻烦比想办法解决问题还要麻烦的时候，这个问题就解决了。
问我说话怎么这么low，因为我心态已经崩了。
#quote Kurapica

#p 21219138 xiaowei 小薇 2019-10-28 21:43:59
校长信箱吧
[https://www.pku.edu.cn/leadermailbox/index.htm](jump-to.php?url=https%3A%2F%2Fwww.pku.edu.cn%2Fleadermailbox%2Findex.htm)
#quote PKUCC

