#t 668 17381299 RyanBern 2019-10-29 11:34:00 PKUCC 2019-10-29 12:28:00
也来谈谈封禁网络端口

#p 21222315 RyanBern r.bern 2019-10-29 11:34:05
本帖是以下帖子（包括但不限于）提到的网络端口问题的整理：
[https://bbs.pku.edu.cn/v2/post-read.php?bid=668&amp;threadid=17378096](post-read.php?bid=668&amp;threadid=17378096)
[https://bbs.pku.edu.cn/v2/post-read.php?bid=668&amp;threadid=17380512](post-read.php?bid=668&amp;threadid=17380512)
[https://bbs.pku.edu.cn/v2/post-read.php?bid=668&amp;threadid=17348964](post-read.php?bid=668&amp;threadid=17348964)
[https://bbs.pku.edu.cn/v2/post-read.php?bid=668&amp;threadid=17359816](post-read.php?bid=668&amp;threadid=17359816)
在整理的同时我希望计算中心有关人员**认真逐条回复**下面的问题。如果不清楚或者不好回答请**明确说明**。如果不清楚问题本身的含义请参考帖子下方的正文。
问题 1：学校内部有公网 IP 的主机开设 ssh 服务并意图让校外主机访问，是否属于网站和信息服务？是否受到《北京大学网络安全管理办法》的约束？**请回答是或否。**
问题 2：如果问题 1 的答案是“否”，是否有规定说明学生个人可以/不得开放端口供校外主机访问？**请回答有或者没有。**
问题 3：如果问题 1 的答案是“是”，该网站的定义是否和通常意义上的“网站”不相符？如果不相符是不是应该额外作解释说明？是否应该建议网信办重新制定有关校内主机端口的规定？
问题 4：除北大 VPN 外，是否有其他正规途径供学生访问校内未备案主机的 ssh 服务？
---
**一、现状和需求**
截止到 2019 年 10 月 29 日，校外主机无法向校内未备案的主机端口发起任何 tcp 连接（IPv4），但 udp 连接和 IPv6 的 tcp 连接仍然可用。由于校外主机大多没有 IPv6 环境，IPv4 访问禁止后，校外无法直接访问校内端口。使用北大 VPN 可以正常访问校内端口，**但北大 VPN 体验很差，延迟高，而且容易掉线**，对很多同学来说北大 VPN 并不好用。
版上很多同学主要需求就是：**在校外能够直接连接校内主机的 ssh 服务，以便方便进行日常科研等工作**
这个需求目前不被满足的原因是：**北大 VPN 体验很差，对外端口又不能使用**
**二、有关北京大学网络安全管理办法**
这份文件很难找，但经过版友 RobinOuyang 的提醒我也找到了这份文件。
这份文件并非像计算中心所说能在网信办查到，网信办的相关页面上只有一个“见 xx 公告”的引用：
[http://ocac.pku.edu.cn/xxaq/xxgzzd/99112.htm](jump-to.php?url=http%3A%2F%2Focac.pku.edu.cn%2Fxxaq%2Fxxgzzd%2F99112.htm)
这份文件实际在校内门户的的“北大制度库”可以查到，使用 IAAA 账号登录门户后，在制度库中搜索“网络安全”就能看到。
我看了几遍这个文件，上面确实没有端口相关的管理。我理解这个规定应该是给学校**部门机构**设立的，所以上面所说的备案等操作也只有部门机构才能进行。换言之，在制定这些规定的时候，学校没有考虑到学生个人过去能拿到公网 IP（参考 [https://cc.pku.edu.cn/about.jsp](jump-to.php?url=https%3A%2F%2Fcc.pku.edu.cn%2Fabout.jsp) ，IP 地址及设置，**教学，科研，办公区**的有线网均为公网 IP），由于许多同学的工位都在办公楼，他们的工位电脑能拿到公网 IP 是再正常不过的事情。之前用的好好的突然给来了个封禁端口换成谁也会不爽。亦或是学校这项制度已经默认学生个**人无权申请域名，静态 IP，端口备案**等。但这份规定上并没有**个人用户不得申请网络端口备案**等字样。
**三、有关申请端口备案**
端口备案的网址是 [https://register.pku.edu.cn](jump-to.php?url=https%3A%2F%2Fregister.pku.edu.cn) ，目前学生个人是无权申请备案的。其原因版友也说了，因为我办过固定 IP，流程真的是这样。
对其他主机提供服务的校内主机，原则上必须采用固定 IP。虽然直接将主机插到墙上也能获得一个公网 IP，实际也可以用，但它并不是固定 IP。固定 IP 是要写在计算中心系统里的。**在这个基础上**，各个单位才能进行域名，端口等备案。
固定 IP 的申请流程也顺便说下，固定 IP 即计算中心网络账号中的**服务器账号**。需要先下载合同，然后盖部门公章，送交计算中心并缴费，然后备案。换言之学生是不能申请服务器账号的，只能通过导师来申请。服务器账号若需要对外访问，收费标准有两种：1）免费地址，价格 30 元/月；2）收费地址，价格 **0.5 元/MB**，这两种地址我都办过，免费地址范围是 CERNET 中定义的地址（并不是所有国内地址都是免费地址，国外地址也可能属于免费地址），30 月的月租对课题组来说可以接受。但收费地址的价格简直是贵到天价了，我所在另一组机器申请收费地址后，一千多网费一周用完的事情时有发生。
Q：如果没有导师怎么办？A：一点办法也没有。除非你变成学校在职人员。
**四、为什么端口要备案**
一方面是为了校园网安全，在这之前校内真的有很多被黑然后在校内疯狂攻击的主机。另一方面是为了明确责任，即出了问题应该找谁。另外个人的看法是学校认为学生个人没有保证自己主机安全的能力，也不相信学生能够老老实实规范使用这些网络端口。
**五、我个人希望的解决办法**
1. 明确《办法》中对网站的定义，消除歧义，否则执行时无法可依。目前看来计算中心给出的回复和同学的诉求明显不 match。
2. 改善北大 VPN 的体验，让同学使用 VPN 不再抱怨。
3. 之前北大超算也无法从外部访问，当时解决办法是专门找了一个跳板机（堡垒机），但要专门申请。如果可以希望也有这样的服务。
**六、其他**
1. 有关 bbs term 端口不能访问的问题。[https://bbs.pku.edu.cn/v2/post-read.php?bid=668&amp;threadid=17359816](post-read.php?bid=668&amp;threadid=17359816)
计算中心的回复看起来比较业余，翻译过来是：**telnet 有安全风险，建议 ssh 访问。**禁止 telnet 我是举双手赞成的，而且看情况 bbs 的 ssh 端口应该已经备案过了。
2. 如果已经出台了类似于**学生不得开设端口供校外主机连接等规定**，有什么应对措施？
内网穿透的方式有很多，例如 ssh 远程端口转发（ssh -R）。亦或是联系导师专门为一台主机申请固定 IP，然后备案，这台主机作为你们课题组入校的跳板。

#p 21222626 PKUCC 北京大学计算中心 2019-10-29 12:27:37
非常感谢您的专业而认真的整理，计算中心当前执行的就是学校有关网络安全管理的规定。至于为了应对VPN的问题，我们正在测试一种技术解决方案，请有需要的同学站内联系我们或发邮件至its@pku.edu.cn。
另外有关您提到的BBS SSH已经备案却不能访问的问题，我们核实后修正，谢谢。
#quote RyanBern

